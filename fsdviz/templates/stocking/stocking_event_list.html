{% extends 'fsdviz_base.html' %}

{% load static %}
{% load humanize %}
{% load fsdviz_tags %}

{% block extra_head  %}

    <style>
     /* body { margin:0;
        position:fixed;
        top:0;
        right:0;
        bottom:0;
        left:0;
        }
      */

     #content{
         padding-left: 10px;
         padding-right: 10px;
     }

    </style>

{% endblock %}

{% block navbar_search %}

    <div class="right menu">
        <form class="item">
            <div class="ui right aligned category search item">
                <div class="ui transparent icon input">
                    <input class="prompt" type="text" placeholder="Search By Event id..." name="q">
                    <i class="search link icon"></i>
                </div>
            </div>
        </form>
    </div>

{% endblock navbar_search%}

{% block content %}


    <div class="ui container fluid" id="content">

        <div class="ui grid">
            <div class="two wide column">

                {% include 'stocking/_refine_events_sidebar.html' %}

            </div>
            <div class="fourteen wide column">
                <div class="ui grid">

                    <div class="row">

                        <div class="ui column">

                            {% if filters %}
                            {% for filter, values in  filters.items %}
                                
                                <a href="{% strip_parameter param=filter %}" class="mini ui icon {{ filter | filter_colour }} button">
                                    {{ filter }} = {{values}}
                                    <i class="times icon"></i>
                                </a>
                                
                            {% endfor %}

                            <a href="#" id="visualize-events-btn" class="mini ui icon right floated green button">
                                Visualize Events
                                <i class="map marked alternate icon"></i>
                            </a>

                            
                            <a href="#" id="download-events-btn" class="mini ui icon right floated primary button">
                                Download events
                                <i class="arrow alternate circle down icon"></i>
                            </a>


                            
                            {% endif %}
                           
                            
                            {% include '_paginator.html' %}


                            <table class="ui very compact celled table tablesorter" style="font-size: 0.9em">
                                <thead>
                                    <tr>
                                        <th scope="col">Stock ID</th>
                                        <th scope="col">Agency</th>
                                        <th scope="col">Lake</th>
                                        <th scope="col">Site</th>
                                        <th scope="col">Date</th>
                                        <th scope="col">Species</th>
                                        <th scope="col">Strain</th>
                                        <th scope="col">Year Class</th>
                                        <th scope="col">Life Stage</th>
                                        <th scope="col">Stocking Method</th>
                                        <th scope="col">Clip</th>
                                        <th scope="col">Mark</th>
                                        <th scope="col">Yr.Eq.</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for object in object_list %}

                                        <tr>
                                            <td> <a href="{% url 'stocking:stocking-event-detail' object.stock_id %}">{{ object.stock_id }}</a></td>
                                            <td> {{ object.agency__abbrev }}</td>
                                            <td> {{ object.jurisdiction__lake__lake_name }}</td>
                                            <td title="{{ object.site }}"> {{ object.site }}</td>
                                            <td> {{ object.date|date:"M-d-y" }}</td>
                                            <td> {{ object.species__common_name | title }}</td>
                                            <td> {{ object.strain_raw__strain__strain_label }}</td>
                                            <td>{{ object.year_class }}</td>
                                            <td> {{ object.lifestage__description | title }}</td>
                                            <td> {{ object.stocking_method__description | title }}</td>
                                            <td>{{object.clip_code__clip_code|default:"---"}}</td>
                                            <td>{{object.mark|default:"---"}}</td>
                                            <td> {{ object.yreq_stocked | intcomma }}</td>

                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>

                            {% include '_paginator.html' %}

                        </div>

                    </div>

                </div>
            </div>

        </div>

    </div>

{% endblock %}

{% block extra_js%}

    <!-- tablesorter plugin-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.17.7/js/jquery.tablesorter.js"></script>

    <!-- tablesorter widget file - loaded after the plugin -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.17.7/js/jquery.tablesorter.widgets.js"></script>

    <script type="text/javascript">

     // add the url parameters to our download button so the same filters can be
     // sent to our download button:
     let search = window.location.search;
     let download_url = "{% url 'api:api-stocking-event-list-xlsx' %}";
     document.getElementById("download-events-btn").href = download_url + search;
     
     let visualize_url = "{% url 'stocking:filtered-stocking-events' %}";
     document.getElementById("visualize-events-btn").href = visualize_url + search;
     
     //document.getElementById("download-events-button").href();

     
     $(".tablesorter").tablesorter({
         theme: 'bootstrap',
         widthFixed: true,
         showProcessing: true,
         headerTemplate: '{content} {icon}',
         widgets: ['zebra', 'uitheme', 'scroller'],
         widgetOptions: {
             scroller_height: 300,
             scroller_barWidth: 17,
             scroller_jumpToHeader: true,
             scroller_idPrefix: 's_'
         }
     });

    </script>

{% endblock %}
