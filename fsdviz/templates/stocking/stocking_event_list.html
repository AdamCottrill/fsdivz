{% extends 'fsdviz_base.html' %}

{% load static %}
{% load humanize %}
{% load fsdviz_tags %}


{% block navbar_search %}

    <div class="right menu">
        <form class="item">
            <div class="ui right aligned category search item">
                <div class="ui transparent icon input">
                    <input class="prompt" type="text" placeholder="Search By Event id..." name="q">
                    <i class="search link icon"></i>
                </div>
            </div>
        </form>
    </div>

{% endblock navbar_search%}

{% block extra_head  %}


    <script src='https://api.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />

    <style>
     /* body { margin:0;
        position:fixed;
        top:0;
        right:0;
        bottom:0;
        left:0;
        }
      */

     #content{
         padding-left: 10px;
         padding-right: 10px;
     }


     #map {
         position:realtive;
         width: 100%;
         height: 700px;
     }
     svg {
         position: absolute;
         width: 100%;
         height: 100%;
     }

     .stockingEvent {
         opacity: 0.4;
         /*          fill: red; */
         stroke: black;
         stroke-width: 1px;
     }


     .hover {
         stroke: black;
         stroke-width: 2;
         opacity: 1.0;
         cursor: pointer;
     }

     .selected {
         stroke: red;
         opacity: 1.0;
         stroke-width: 1.5;
     }





    </style>

{% endblock %}




{% block content %}


    <div class="ui container fluid" id="content">

        <div class="ui grid">
            <div class="two wide column">

                {% include 'stocking/_refine_events_sidebar.html' %}

            </div>
            <div class="fourteen wide column">
                <div class="ui grid">

                    <div class="row">
                        <div class="twelve wide column">
                            <h3>Stocking Events {% if lake %} for {{lake.lake_name}} {% elif jurisdiction %} in the {{ jurisdiction.description }}{%endif%} {% if year %}{{ year }}{% endif %}
                            </h3>
                        </div>
                        <div class="four wide right aligned column">

                            {% if year%}

                                <a class="ui left labeled icon mini blue compact button" href="{% last_year year%}"><i class="left arrow icon"></i>Previous Year</a>

                                <a class="ui right labeled icon mini blue compact button"href="{% next_year year%}"><i class="right arrow icon"></i>Next Year</a>

                            {% endif %}
                        </div>
                    </div>

                    <div class="row">

                        <div class="twelve wide column">
                            <div id="map"></div>
                        </div>
                        <div class="four wide column">

                            <div class="ui fluid card">
                                <div class="content">
                                    <div class="header">Stats Panel</div>
                                </div>
                                <div class="content">
                                    <p>Interesting stats here.</p>

                                    <ul>
                                        <li><span id="total-stocked"></span> Fish</li>
                                        <li><span id="event-count"></span> Events</li>
                                        <li><span id="species-count"></span> Species</li>
                                    </ul>

                                    <div id="stocked-summary-table">
                                        <table class="ui celled table tablesorter" style="font-size: 0.7em">
                                            <thead>
                                                <tr><th>Species</th>
                                                    <th>Events</th>
                                                    <th>Fish</th>
                                                </tr></thead>
                                            <tbody id="stocked-summary-table-tbody">
                                            </tbody>
                                        </table>
                                    </div>
                                    <br />
                                    <div class="ui row">
                                        <div id="point-info"></div>
                                    </div>
                                </div>
                            </div>

                        </div>


                    </div>
                    <div class="row">

                        <div class="ui column">

                            {% include '_paginator.html '%}


                            <table class="ui celled table tablesorter" style="font-size: 0.9em">
                                <thead>
                                    <tr>
                                        <th scope="col">Stock ID</th>
                                        <th scope="col">Agency</th>
                                        <th scope="col">Lake</th>
                                        <th scope="col">Site</th>
                                        <th scope="col">Date</th>
                                        <th scope="col">Species</th>
                                        <th scope="col">Strain</th>
                                        <th scope="col">Year Class</th>
                                        <th scope="col">Life Stage</th>
                                        <th scope="col">Stocking Methd</th>
                                        <th scope="col">Mark</th>
                                        <th scope="col">Yr.Eq.</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for object in object_list %}

                                        <tr>
                                            <td> <a href="{% url 'stocking:stocking-event-detail' object.stock_id %}">{{ object.stock_id }}</a></td>
                                            <td> {{ object.agency.abbrev }}</td>
                                            <td> {{ object.lake.short_name }}</td>
                                            <td title="{{ object.site }}"> {{ object.site }}</td>
                                            <td> {{ object.date|date:"M-d-y" }}</td>
                                            <td> {{ object.species.common_name | title }}</td>
                                            <td> {{ object.strain_raw.strain.strain_label }}</td>
                                            <td>{{ object.year_class }}</td>
                                            <td> {{ object.lifestage.description | title }}</td>
                                            <td> {{ object.stocking_method.description | title }}</td>                    <td>{{object.mark}}</td>
                                            <td> {{ object.yreq_stocked | intcomma }}</td>

                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>

                            {% include '_paginator.html '%}

                        </div>

                    </div>

                </div>
            </div>

        </div>

    </div>






{% endblock %}


{% block extra_js%}


    <!-- tablesorter plugin-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.17.7/js/jquery.tablesorter.js"></script>

    <!-- tablesorter widget file - loaded after the plugin -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.17.7/js/jquery.tablesorter.widgets.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.9.2/d3.min.js"
            integrity="sha256-k9RyZhvMj2bg0fd8L3IE41t0HpTXnivMoePN/Ksq250="
            crossorigin="anonymous"></script>


    <script type="text/javascript">


     $(".tablesorter").tablesorter({
         theme: 'bootstrap',
         widthFixed: true,
         showProcessing: true,
         headerTemplate: '{content} {icon}',
         widgets: ['zebra', 'uitheme', 'scroller'],
         widgetOptions: {
             scroller_height: 300,
             scroller_barWidth: 17,
             scroller_jumpToHeader: true,
             scroller_idPrefix: 's_'
         }
     });


     {% if extent  %}

     const bbox = {{ extent|safe }};

     {% else  %}

     const bbox = [-92.0940,
                    41.3808,
                   -76.0591,
                    49.0158]

     {% endif %}


    </script>



    <!-- load the js file that loads the data and provides all of the interaction -->
    <script src="{% static "js/mapbox_overlay.js"  %}"></script>
    <script src="{% static "js/stocking_event_list_map.js"  %}"></script>



{% endblock %}
